<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Curso de Acuarela - Contenido</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Oculta contenido hasta verificar acceso */
    html.locked { visibility: hidden; }
  </style>
</head>
<body class="locked">
  <nav class="navbar navbar-expand-lg navbar-light bg-white bg-opacity-70 backdrop-blur border-bottom sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">Curso de Acuarela</a>
      <div class="ms-auto d-flex gap-2">
        <a href="mis-cursos.html" class="btn btn-outline-secondary btn-sm">Mis cursos</a>
        <button id="btnLogout" class="btn btn-outline-secondary btn-sm d-none" onclick="appLogout()">
          <i class="bi bi-box-arrow-right me-1"></i>Salir
        </button>
      </div>
    </div>
  </nav>

  <header class="py-4 bg-hero">
    <div class="container">
      <h1 class="h3 fw-extrabold text-gradient mb-1">Acuarela Básica</h1>
      <p class="text-secondary mb-0">Bienvenid@ al contenido del curso. Disfruta y aprende a tu ritmo.</p>
    </div>
  </header>

  <main class="container py-4">
    <!-- Bloque de contenido del curso -->
    <div class="row g-4">
      <div class="col-lg-8">
        <div class="card shadow-sm glass-card">
          <div class="card-body">
            <h5 class="card-title">Lección 1: Materiales y preparación</h5>
            <div class="ratio ratio-16x9 mb-3">
              <!-- Reemplaza por tu video embebido o recurso -->
              <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="Video" allowfullscreen></iframe>
            </div>
            <p class="card-text">Introducción a los materiales, papeles, pinceles y paletas. Recomendaciones iniciales.</p>
          </div>
        </div>

        <div class="card shadow-sm glass-card mt-4">
          <div class="card-body">
            <h5 class="card-title">Lección 2: Degradados y lavados</h5>
            <p class="card-text">Practica los básicos para dominar el agua y el pigmento.</p>
            <img src="assets/lamina-ejemplo.png" class="img-fluid rounded" alt="Lámina de práctica">
            <div class="mt-3">
              <a class="btn btn-outline-primary btn-sm" href="assets/lamina-ejemplo.png" download>
                <i class="bi bi-download me-1"></i> Descargar lámina
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="col-lg-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="fw-bold">Progreso</h6>
            <div class="progress mb-2" role="progressbar" aria-label="Progreso" aria-valuemin="0" aria-valuemax="100">
              <div id="progressBar" class="progress-bar" style="width: 0%">0%</div>
            </div>
            <button class="btn btn-sm btn-outline-success me-1" onclick="marcarAvance(25)">+25%</button>
            <button class="btn btn-sm btn-outline-success me-1" onclick="marcarAvance(50)">+50%</button>
            <button class="btn btn-sm btn-outline-secondary" onclick="marcarAvance(0)">Reiniciar</button>
          </div>
        </div>

        <div class="card shadow-sm mt-3">
          <div class="card-body">
            <h6 class="fw-bold">Recursos</h6>
            <ul class="small list-unstyled mb-0">
              <li class="mb-1"><a href="imagenes.html"><i class="bi bi-images me-1"></i>Banco de imágenes</a></li>
              <li class="mb-1"><a href="calendario.html"><i class="bi bi-calendar-event me-1"></i>Calendario</a></li>
              <li class="mb-1"><a href="cursos.html"><i class="bi bi-bag me-1"></i>Comprar otros cursos</a></li>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </main>

  <footer class="py-4">
    <div class="container small text-center text-secondary">© 2025 Acuarela</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Protección y lógica de progreso -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // CONFIG REAL
  const firebaseConfig = {
  apiKey: "AIzaSyDz0gGjx6Rw01MJ-s4hZC5DwYuGymeOL44",
  authDomain: "acuarela-e4613.firebaseapp.com",
  projectId: "acuarela-e4613",
  storageBucket: "acuarela-e4613.firebasestorage.app",
  messagingSenderId: "319613648205",
  appId: "1:319613648205:web:f693e3f4e1b9abd4aa0b04",
  measurementId: "G-KMJW7RZRTT"
};

    const COURSE_ID = "curso_unico"; // usa este mismo ID al dar acceso en Firestore users/{uid}.accessCourses

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const btnLogout = document.getElementById('btnLogout');

    onAuthStateChanged(auth, async (user)=>{
      if(!user){ location.href = "index.html"; return; }
      btnLogout.classList.remove('d-none');

      // Verificar acceso del usuario
      const userSnap = await getDoc(doc(db, 'users', user.uid));
      const access = userSnap.exists() ? (userSnap.data().accessCourses || []) : [];
      if (!access.includes(COURSE_ID)) {
        alert("No tienes acceso a este curso. Si ya pagaste, espera la aprobación.");
        location.href = "mis-cursos.html";
        return;
      }
      // Desbloquear la vista
      document.body.classList.remove('locked');

      // Cargar progreso guardado local (opcional)
      const key = `progress_${COURSE_ID}_${user.uid}`;
      const value = localStorage.getItem(key);
      if (value) setProgress(parseInt(value,10));
    });

    window.appLogout = async () => { await signOut(auth); location.href="index.html"; };

    // Progreso simple con localStorage
    const progressBar = document.getElementById('progressBar');
    function setProgress(p){
      p = Math.max(0, Math.min(100, p));
      progressBar.style.width = p + '%';
      progressBar.textContent = p + '%';
    }
    window.marcarAvance = (p)=>{
      const user = JSON.parse(localStorage.getItem('user')||'{}');
      const key = `progress_${COURSE_ID}_${user.uid||'anon'}`;
      localStorage.setItem(key, p);
      setProgress(p);
    };
  </script>
</body>
</html>

