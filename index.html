<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Curso de Acuarela - Iniciar sesión</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header class="navbar">
    <div class="container">
      <a class="brand" href="index.html">Acuarela</a>
      <nav>
        <a href="index.html" class="active">Inicio</a>
        <a href="curso.html">Curso</a>
        <a href="imagenes.html">Imágenes</a>
        <a href="calendario.html">Calendario</a>
        <button id="btnLogout" class="btn btnLight" style="display:none;" onclick="appLogout()">Salir</button>
      </nav>
    </div>
  </header>

  <main class="container" style="padding-top:24px;">
    <div class="grid-2">
      <section class="card">
        <h1>Bienvenid@ al mundo de la acuarela</h1>
        <ul>
          <li>Lecciones con control de avance</li>
          <li>Imágenes PNG para descargar</li>
          <li>Calendario de actividades</li>
        </ul>
      </section>

      <section class="card" style="max-width:640px;margin-left:auto;">
        <h2>Inicia sesión</h2>
        <form id="loginForm">
          <label>Correo</label>
          <input type="email" name="email" placeholder="tu@correo.com" required />
          <label>Contraseña</label>
          <input type="password" name="password" placeholder="Tu contraseña" required />
          <button type="submit" class="btn" style="margin-top:12px;">Entrar</button>
        </form>

        <div style="margin:16px 0;text-align:center;color:#666;">o</div>

        <button type="button" class="btn btnLight" onclick="googleLogin()">
          Iniciar sesión con Google
        </button>

        <hr style="margin:24px 0; opacity:.2;">

        <h3>Crear cuenta</h3>
        <form id="registerForm">
          <label>Nombre de usuario (alias)</label>
          <input type="text" name="displayName" placeholder="Tu nombre visible" required />
          <label>Correo</label>
          <input type="email" name="email" placeholder="tu@correo.com" required />
          <label>Contraseña</label>
          <input type="password" name="password" placeholder="Mínimo 6 caracteres" required />
          <button type="submit" class="btn btnLight" style="margin-top:12px;">Registrarme</button>
        </form>
      </section>
    </div>
  </main>

  <footer class="footer">
    <div class="container">© 2025 Acuarela</div>
  </footer>

  <!-- SDKs de Firebase cargados como módulo -->
  <script type="module">
    // Importar SDKs desde CDN (v10.13.1; puedes usar la última estable)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      updateProfile,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

    // REEMPLAZA con TU configuración de Firebase
    const firebaseConfig = {
  apiKey: "AIzaSyDz0gGjx6Rw01MJ-s4hZC5DwYuGymeOL44",
  authDomain: "acuarela-e4613.firebaseapp.com",
  projectId: "acuarela-e4613",
  storageBucket: "acuarela-e4613.firebasestorage.app",
  messagingSenderId: "319613648205",
  appId: "1:319613648205:web:f693e3f4e1b9abd4aa0b04",
  measurementId: "G-KMJW7RZRTT"
};

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // Exponer funciones a la ventana para usarlas en onclick
    window.googleLogin = async () => {
      try {
        await signInWithPopup(auth, provider);
        // Redirige al curso al iniciar
        window.location.href = "curso.html";
      } catch (e) {
        alert("No se pudo iniciar con Google: " + e.message);
        console.error(e);
      }
    };

    window.appLogout = async () => {
      await signOut(auth);
      // Opcional: volver al inicio
      window.location.href = "index.html";
    };

    // Manejo de formularios
    document.addEventListener("DOMContentLoaded", () => {
      const loginForm = document.getElementById("loginForm");
      const registerForm = document.getElementById("registerForm");

      if (loginForm) {
        loginForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = loginForm.email.value.trim();
          const password = loginForm.password.value;
          try {
            await signInWithEmailAndPassword(auth, email, password);
            window.location.href = "curso.html";
          } catch (err) {
            alert("Credenciales inválidas o usuario no registrado.");
            console.error(err);
          }
        });
      }

      if (registerForm) {
        registerForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const displayName = registerForm.displayName.value.trim();
          const email = registerForm.email.value.trim();
          const password = registerForm.password.value;
          if (password.length < 6) {
            alert("La contraseña debe tener al menos 6 caracteres.");
            return;
          }
          try {
            const cred = await createUserWithEmailAndPassword(auth, email, password);
            if (displayName) {
              await updateProfile(cred.user, { displayName });
            }
            alert("Cuenta creada. Ya puedes iniciar sesión.");
            registerForm.reset();
          } catch (err) {
            alert(err.message);
            console.error(err);
          }
        });
      }
    });

    // Actualizar UI según estado de sesión
    onAuthStateChanged(auth, (user) => {
      const btnLogout = document.getElementById("btnLogout");
      if (user) {
        // Guardar sesión mínima en localStorage (opcional)
        localStorage.setItem("user", JSON.stringify({
          uid: user.uid,
          email: user.email,
          name: user.displayName || user.email
        }));
        if (btnLogout) btnLogout.style.display = "inline-flex";
      } else {
        localStorage.removeItem("user");
        if (btnLogout) btnLogout.style.display = "none";
      }
    });
  </script>
</body>
</html>
